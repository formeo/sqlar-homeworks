# Домашнее задание к занятию "Мониторинг состояния БД"


### Цель задания

В результате выполнения этого задания вы ... 

`В этом блоке опиши зачем и почему студенту следует выполнить эту домашнюю работу, какую пользу он извлечет, чему научится. Выполнение задания потенциально должно быть интересно студенту.`

1. ...
2. ...

`Опиши основные учебные цели домашней работы, которые студент сможет реализовать в ходе выполнения задания. Цели лучше работают, когда они прописаны на доступном для студента языке. Цели должны раскрывать основные практические навыки, которые освоит студент при выполнении задания.`

`Примечание: Если разработка программы ведется по МаКо, рекомендуется цели синхронизовать с данными матрицы компетенций, которые можно запросить у методиста курса.`

------

### Чеклист готовности к домашнему заданию

1. ...
2. ...

`Если для выполнения домашнего задания студенту требуется предварительная подготовка необходимых материалов, настройки ПО и т. п., рекомендуется вынести эти этапы в отдельный чеклист. Распиши по пунктам основные предварительные задачи для студента, дай ссылки на необходимые материалы в случае необходимости.`

`Примечание: Данный блок является не обязательным. Если нет в нем необходимости, его можно удалить.`

------

### Инструкция к заданию

1. ...
2. ...

`Приведи четкую и понятную инструкцию по выполнению работы. Инструкция содержит основные этапы выполнения работы в общих чертах. Здесь следует раскрыть формат и порядок выполнения и сдачи работы эксперту на проверку. Укажи как можно обратиться к эксперту в случае возникновения вопросов по домашнему заданию.`

------

### Инструменты/ дополнительные материалы, которые пригодятся для выполнения задания

1. ...
2. ...

`Опиши тезисно инструменты и дополнительные материалы, которые потенциально могут понадобиться студенту в ходе выполнения домашнего задания, дай на них ссылки при необходимости.`

------
`Ниже подробно опиши сами задания для студента. Задания содержат текст условий задач, необходимые ссылки, рекомендации, рисунки и другие необходимые материалы. Также здесь можно дополнительно описать формат выполнения заданий, привести шаблон задания. На шаблон можно дать ссылку.`

`Примечание: Шаблон не является обязательным элементом для инструкции. Ниже приведен пример шаблона. При работе с шаблоном рекомендуется документ скопировать на диск или дать ссылку на собственный разработанный шаблон.`

------

### Задание 1

1. Требуется изменить наименование файла-журнала БД на формат имени postgres-XXX, где ХХХ - день недели и включить ротирование файлов, так чтобы постоянно оставалось 7 файлов на каждый день недели.
2. Необходимо включить запись событий подключения сессии пользователя и запись запроса, который выполняется больше 1 сек.
3. Воспользовавшись представлением статистики необходио увидеть и определить время подключения сессии, под которой вы сейчас работаете, её текущеее состояние и тип сессии `backend_type`.
4. Во 2-ом терминале подключения к БД, выполнить команду отключения сеанса 1-го терминала.
5. Определить ТОП-1 самых часто запускаемый запрос.

------

### Задание 2

1. Требуется изменить ротирование файла-журнала так, чтобы файл достигал размера до 500МБ, при превышении становился архивом, а на его место создавался новый пустой файл.
2. Необходимо включить запись события отключения сессии пользователя и запись всех выполняемых DML операций.
3. Воспользовавшись представлением статистики необходио увидеть и определить продолжительность (сколько прошло времени на текущий момент со времени подключения к БД) работы вашеей сессий, под которой вы сейчас работаете, ее текущеее состояние и тип сессии `backend_type`.
4. В 1-ом терминале выполнить начало транзакции `begin transaction;`.  
Какую команду нужно выполнить во 2-ом терминале подключения к БД, чтобы прервать работу сессии в 1-ом терминале и подойдет ли для этого команда `pg_cancel_backend()`?
5. Оперделить ТОП-1 из самых затратных по процессорным ресурсам запросов (приведите команду SQL и вывод команды)
6. Посмотреть статистику работы процесса checkpoint и дать оценку: на сколько эффективно он работает, что стоит изменить?
7. Посмотреть план выполнения запроса `explain select count(*) from table;`.  
Какую стоимость ставит планировщик для чтения таблицы?

------

## Задание 3*

Посмотреть статистику по количеству строк и блоков у таблицы (содержащую 5-10 тыс строк), выполнить встравку/удаление 1-2 строк и добиться того, чтобы статистика показала это увеличение.

1. в 1-ом терминале
    - выполнить вставку в таблицу, выполнить `COMMIT`
    - начать транзакцию `BEGIN TRANSACTION`
    - выполнить UPDATE вставленной записи, не выполняя `COMMIT` или `ROLLBACK`
2. во 2-ом терминале
    - начать транзакцию `BEGIN TRANSACTION`
    - выполнить `UPDATE` той же строки

Что наблюдаем при выполнении команды ?
В представлении pg_stat_activity нужно увидеть статус сессии 1-го и 2-го терминала, какие wait_event, wait_event_type?




------

### Правила приема работы

1. ...
2. ...

`Опиши кратко технические требований для сдачи работы: объём, форма/формат.` 

`Например:`
- `отправлена ссылка на документ (Google Doc) с выполненным заданием в личном кабинете;`
- `документ размещен на личном Google Disk;`
- `к документу настроены права доступа “Просматривать могут все в Интернете, у кого есть ссылка”.`

------

### Критерии оценки

1. ...
2. ...

`Подробно пропиши критерии оценивания. В критериях отрази условия, при которых студент получит или не получит зачёт. Критерии должны содержать чёткие и однозначные формулировки, понятные студенту и тренеру курса.`
